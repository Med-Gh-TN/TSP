<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Problème du Voyageur de Commerce: Algorithmes Génétiques (Sélection par Roulette)</title>
    
    <!-- Google Fonts for a premium feel -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Prism.js for code highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" rel="stylesheet" />

    <style>
        /* --- "BIOLUMINESCENT FOREST" THEME & ALL STYLES --- */
        
        :root {
            --bg-gradient-start: #0f2027;
            --bg-gradient-end: #050e10;
            --accent-primary: #00FFAB;
            --accent-cyan: #00E0FF;
            --accent-magenta: #F72585;
            --text-primary: #FFFFFF;
            --text-secondary: #a1a1a6;
            --glass-bg: rgba(0, 255, 171, 0.05);
            --glass-border: rgba(255, 255, 255, 0.15);
            --font-stack: -apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --border-radius: 16px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: var(--font-stack);
            line-height: 1.6;
            color: var(--text-primary);
            background-color: var(--bg-gradient-end);
            background-image: radial-gradient(circle at top left, var(--bg-gradient-start), var(--bg-gradient-end));
            background-attachment: fixed;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        header { text-align: center; padding: 3rem 1rem; }
        header h1 { font-size: 2.5rem; font-weight: 700; }
        main { max-width: 1600px; margin: 1rem auto; padding: 0 2rem; }
        section { padding: 2.5rem; margin-bottom: 3rem; }
        h2 { color: var(--text-primary); margin-bottom: 0.5rem; text-align: center; font-weight: 600; font-size: 2rem; }
        .subtitle { text-align: center; color: var(--text-secondary); margin-bottom: 3rem; max-width: 600px; margin-left: auto; margin-right: auto; }

        #demo .demo-container { display: flex; gap: 2.5rem; flex-wrap: wrap; align-items: flex-start; }
        #demo .canvas-wrapper { flex: 1.5; min-width: 500px; }
        #demo .controls-wrapper { flex: 1; min-width: 350px; }
        
        #tspCanvas {
            width: 100%;
            height: auto;
            border-radius: var(--border-radius);
            background-color: rgba(0, 0, 0, 0.2);
            background-image: 
                linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px), 
                linear-gradient(to right, rgba(255,255,255,0.05) 1px, transparent 1px);
            background-size: 40px 40px;
            border: 1px solid var(--glass-border);
        }

        .panel {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s ease;
        }
        
        #best-solution-panel.new-best { background: rgba(255, 255, 255, 0.9); color: #111; }
        #best-solution-panel.new-best h4 { color: #111; }
        #best-solution-panel.new-best span { color: #050e10; /* High contrast fix */ }

        .panel h4 { font-weight: 500; color: var(--text-secondary); margin-bottom: 1rem; border-bottom: 1px solid var(--glass-border); padding-bottom: 1rem; }
        .panel span { font-family: 'Menlo', 'Fira Code', monospace; font-size: 1.1rem; word-wrap: break-word; color: var(--text-primary); font-weight: 500; }
        .panel p { margin-top: 0.5rem; }
        
        .button-group { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 2rem; }
        .button-group button { width: 100%; padding: 1rem; font-size: 1rem; font-weight: 600; border: none; border-radius: 12px; cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease; }
        #next-step-btn { background: var(--accent-primary); color: #050e10; }
        #restart-btn { background: var(--glass-bg); border: 1px solid var(--glass-border); color: var(--text-primary); }
        .button-group button:hover { transform: translateY(-3px); box-shadow: 0 8px 30px rgba(0,0,0,0.3); }
        .button-group button:disabled { background: rgba(255, 255, 255, 0.1); color: var(--text-secondary); cursor: not-allowed; transform: none; box-shadow: none; }
        
        #code-mapping { background: transparent; }
        #code-mapping .code-container { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
        pre[class*="language-"] { border: 1px solid var(--glass-border) !important; border-radius: var(--border-radius) !important; background: rgba(0,0,0,0.2) !important; transition: all 0.3s ease !important; }
        pre[class*="language-"].highlight { border-color: var(--accent-primary) !important; transform: scale(1.02); box-shadow: 0 5px 25px rgba(0, 255, 171, 0.2); }

        @media (max-width: 1200px) { #demo .demo-container { flex-direction: column; } }
        @media (max-width: 900px) { #code-mapping .code-container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <header>
        <h1>Problème du Voyageur de Commerce</h1>
        <p class="subtitle" style="font-size: 1.2rem; max-width: 800px;">Découvrez comment les Algorithmes Génétiques "élèvent" des solutions par sélection (roulette), croisement et mutation.</p>
    </header>

    <main>
        <section id="demo">
            <div class="demo-container">
                <div class="canvas-wrapper">
                    <canvas id="tspCanvas" width="600" height="450"></canvas>
                </div>
                <div class="controls-wrapper">
                    <div class="panel" id="status-panel">
                        <h4>Progression de l'Algorithme</h4>
                        <p id="step-description">Cliquez sur "Commencer" pour lancer la simulation.</p>
                    </div>

                    <div class="panel" id="generation-panel">
                        <h4>Génération</h4>
                        <span id="generation-value" style="color: var(--accent-cyan); font-size: 1.5rem;">-</span>
                    </div>

                    <div class="panel" id="fitness-panel">
                        <h4>Meilleure Fitness (1/Distance)</h4>
                        <span id="fitness-value" style="color: var(--accent-primary); font-size: 1.5rem;">-</span>
                    </div>

                    <div class="panel" id="best-solution-panel">
                        <h4>Meilleure Solution Trouvée</h4>
                        <span id="best-path">N/A</span>
                        <p>Distance: <span id="best-distance">-</span></p>
                    </div>

                    <div class="button-group">
                        <button id="restart-btn">Recommencer</button>
                        <button id="next-step-btn">Commencer</button>
                    </div>
                </div>
            </div>
        </section>

        <section id="code-mapping">
            <h2>Du Concept au Code Python</h2>
            <p class="subtitle">Chaque étape de l'évolution correspond à un opérateur génétique dans le code.</p>
            
            <div class="code-container">
                <pre id="code-selection"><code class="language-python">
# Sélection par Roulette
def selection_parents_roulette(population, fitnesses):
    """Les individus avec une meilleure fitness 
    ont plus de chance d'être sélectionnés."""
    total_fitness = sum(fitnesses)
    # On 'lance la bille' sur la roue
    selection = random.uniform(0, total_fitness)
    # ... on trouve où elle s'arrête
    return parent1, parent2
                </code></pre>

                <pre id="code-crossover"><code class="language-python">
# Croisement (Ordered Crossover)
def croisement(parent1, parent2):
    """Combine les gènes de deux parents
    pour créer un nouvel enfant."""
    # 1. Copier un segment du parent1
    enfant[debut:fin] = parent1[debut:fin]
    # 2. Remplir le reste avec les gènes du parent2
    # en évitant les doublons
    return enfant
                </code></pre>

                <pre id="code-mutation"><code class="language-python">
# Mutation
def mutation(solution, taux_mutation):
    """Introduit de la diversité en modifiant
    aléatoirement un individu."""
    if random.random() < taux_mutation:
        # Échanger deux villes au hasard
        i, j = random.sample(range(len(solution)), 2)
        solution[i], solution[j] = solution[j], solution[i]
    return solution
                </code></pre>
                
                <pre id="code-evolution"><code class="language-python">
# Boucle principale d'évolution
for generation in range(nombre_generations):
    # Conserver les meilleurs (Élitisme)
    nouvelle_population.extend(elite)

    # Remplir avec de nouveaux enfants
    while len(nouvelle_population) < taille_population:
        # Sélection -> Croisement -> Mutation
        ...
    # Remplacer l'ancienne population
    population = nouvelle_population
                </code></pre>
            </div>
        </section>
    </main>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- CONFIGURATION & DATA ---
            const canvas = document.getElementById('tspCanvas');
            const ctx = canvas.getContext('2d');
            const matrice_distances = [
                [0, 2, 7, 15, 2, 5, 7, 6, 6, 5], [2, 0, 10, 4, 7, 3, 7, 15, 8, 2],
                [2, 10, 0, 1, 4, 3, 3, 4, 2, 3], [7, 4, 1, 0, 2, 15, 7, 7, 5, 4],
                [7, 10, 4, 2, 0, 7, 3, 2, 2, 7], [2, 3, 3, 7, 7, 0, 1, 7, 2, 10],
                [5, 7, 3, 7, 3, 1, 0, 2, 1, 3], [7, 7, 4, 7, 2, 7, 2, 0, 1, 10],
                [6, 8, 2, 5, 2, 2, 1, 1, 0, 15], [5, 2, 3, 4, 7, 10, 3, 10, 15, 0]
            ];
            const cityCoords = [
                { x: 100, y: 50 }, { x: 500, y: 80 }, { x: 80, y: 150 }, { x: 200, y: 180 },
                { x: 300, y: 250 }, { x: 50, y: 320 }, { x: 180, y: 350 }, { x: 350, y: 100 },
                { x: 450, y: 300 }, { x: 550, y: 200 }
            ];
            const vibrantPathColors = ['#00E0FF', '#F72585', '#FFCC00'];
            
            // --- UI ELEMENTS ---
            const nextStepBtn = document.getElementById('next-step-btn');
            const restartBtn = document.getElementById('restart-btn');
            const stepDescriptionEl = document.getElementById('step-description');
            const bestPathEl = document.getElementById('best-path');
            const bestDistanceEl = document.getElementById('best-distance');
            const generationValueEl = document.getElementById('generation-value');
            const fitnessValueEl = document.getElementById('fitness-value');
            const bestSolutionPanel = document.getElementById('best-solution-panel');
            const allCodeBlocks = document.querySelectorAll('#code-mapping pre');

            // --- STATE MANAGEMENT ---
            let currentStep = -1;
            let story;

            // --- HELPER & STORY FUNCTIONS ---
            function calculateDistance(solution) {
                let distance = 0;
                for (let i = 0; i < solution.length; i++) {
                    distance += matrice_distances[solution[i]][solution[(i + 1) % solution.length]];
                }
                return distance;
            }

            function calculateFitness(distance) { return distance === 0 ? Infinity : 1 / distance; }

            function generateStory() {
                const steps = [];
                let initialSolution = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];
                let bestSolution = [...initialSolution];
                
                steps.push({ description: "L'algorithme commence avec une 'population' de solutions entièrement aléatoires. La plupart sont très mauvaises, comme celle-ci.", currentSolution: [...initialSolution], bestSolution: [...bestSolution], generation: 1, codeBlockId: 'code-evolution', newBest: true });
                steps.push({ description: "SÉLECTION: C'est la survie du plus apte. Les meilleures solutions (fitness élevée) sont sélectionnées comme 'parents' pour créer la prochaine génération.", currentSolution: [0, 5, 2, 3, 4, 1, 6, 7, 8, 9], bestSolution: [0, 5, 2, 3, 4, 1, 6, 7, 8, 9], generation: 50, codeBlockId: 'code-selection', newBest: true });
                steps.push({ description: "CROISEMENT: Deux parents combinent leurs 'gènes' (ordres des villes) pour créer un nouvel 'enfant', qui hérite des bonnes caractéristiques de chacun.", currentSolution: [4, 7, 8, 6, 5, 1, 0, 9, 2, 3], bestSolution: [0, 5, 2, 3, 4, 1, 6, 7, 8, 9], generation: 150, codeBlockId: 'code-crossover', newBest: false });
                steps.push({ description: "MUTATION: Pour éviter la stagnation, une 'mutation' aléatoire se produit parfois. Deux villes sont échangées, introduisant de la nouveauté dans la population.", currentSolution: [4, 7, 8, 6, 5, 0, 1, 9, 2, 3], bestSolution: [4, 7, 8, 6, 5, 0, 1, 9, 2, 3], generation: 151, codeBlockId: 'code-mutation', newBest: true });
                steps.push({ description: "NOUVELLE GÉNÉRATION: Le cycle se répète. Les nouveaux enfants remplacent les individus les plus faibles, augmentant la qualité moyenne de la population à chaque génération.", currentSolution: [4, 7, 8, 6, 5, 0, 1, 9, 2, 3], bestSolution: [4, 7, 8, 6, 5, 0, 1, 9, 2, 3], generation: 400, codeBlockId: 'code-evolution', newBest: false });
                steps.push({ description: "FIN ! Après des centaines de générations, la population a évolué pour contenir des solutions d'élite. Voici la meilleure trouvée, avec une distance minimale de 17.", currentSolution: [4, 7, 8, 6, 5, 0, 1, 9, 2, 3], bestSolution: [4, 7, 8, 6, 5, 0, 1, 9, 2, 3], generation: 500, codeBlockId: null, newBest: false });

                return steps;
            }

            // --- VISUALIZATION FUNCTIONS ---
            function drawPath(solution, color = '#FFFFFF', lineWidth = 2) {
                if (!solution || solution.length === 0) return;
                ctx.beginPath();
                ctx.moveTo(cityCoords[solution[0]].x, cityCoords[solution[0]].y);
                for (let i = 1; i < solution.length; i++) {
                    ctx.lineTo(cityCoords[solution[i]].x, cityCoords[solution[i]].y);
                }
                ctx.lineTo(cityCoords[solution[0]].x, cityCoords[solution[0]].y);
                ctx.strokeStyle = color;
                ctx.lineWidth = lineWidth;
                ctx.stroke();
            }
            
            // --- UPDATED FUNCTION FOR HIGH-CONTRAST NODES ---
            function drawCityNodes() {
                 cityCoords.forEach((coord) => {
                    ctx.beginPath();
                    ctx.arc(coord.x, coord.y, 12, 0, Math.PI * 2);
                    
                    // Use a dark fill for high contrast behind the text
                    ctx.fillStyle = '#0f2027';

                    // Use the vibrant accent color for the "neon" outline
                    ctx.strokeStyle = '#00FFAB'; 

                    // Make the outline thicker to enhance the effect
                    ctx.lineWidth = 3; 

                    ctx.fill();
                    ctx.stroke();
                });
            }
            
            function drawCityText() {
                 cityCoords.forEach((coord, i) => {
                    ctx.fillStyle = '#FFFFFF';
                    ctx.font = 'bold 14px Inter';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(i, coord.x, coord.y);
                });
            }

            function highlightCodeBlock(id) {
                allCodeBlocks.forEach(block => block.classList.remove('highlight'));
                if (id) { document.getElementById(id).classList.add('highlight'); }
            }
            
            function updateUI(step) {
                stepDescriptionEl.textContent = step.description;
                const bestDist = calculateDistance(step.bestSolution);
                bestPathEl.textContent = `[${step.bestSolution.join(', ')}]`;
                bestDistanceEl.textContent = bestDist;
                generationValueEl.textContent = step.generation;
                fitnessValueEl.textContent = calculateFitness(bestDist).toFixed(4);

                bestSolutionPanel.classList.remove('new-best');
                if (step.newBest) { setTimeout(() => bestSolutionPanel.classList.add('new-best'), 50); }

                highlightCodeBlock(step.codeBlockId);
                
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                const dynamicColor = vibrantPathColors[currentStep % vibrantPathColors.length];
                drawPath(step.bestSolution, 'rgba(0, 255, 171, 0.5)', 2);
                drawPath(step.currentSolution, dynamicColor, 3.5);
                drawCityNodes();
                drawCityText();
            }

            function resetAnimation() {
                currentStep = -1;
                story = null;
                nextStepBtn.disabled = false;
                nextStepBtn.textContent = 'Commencer';
                stepDescriptionEl.textContent = 'Cliquez sur "Commencer" pour lancer la simulation.';
                bestPathEl.textContent = 'N/A';
                bestDistanceEl.textContent = '-';
                generationValueEl.textContent = '-';
                fitnessValueEl.textContent = '-';
                bestSolutionPanel.classList.remove('new-best');
                highlightCodeBlock(null);
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawCityNodes();
                drawCityText();
            }

            // --- EVENT LISTENERS ---
            nextStepBtn.addEventListener('click', () => {
                if (currentStep === -1) {
                    story = generateStory();
                    nextStepBtn.textContent = 'Étape Suivante >';
                }
                currentStep++;
                if (currentStep < story.length) {
                    updateUI(story[currentStep]);
                }
                if (currentStep >= story.length - 1) {
                    nextStepBtn.textContent = 'Terminé !';
                    nextStepBtn.disabled = true;
                }
            });

            restartBtn.addEventListener('click', resetAnimation);

            // --- INITIALIZATION ---
            resetAnimation();
        });
    </script>
</body>
</html>